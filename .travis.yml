language: python
cache:
  directories:
  - "$PIP_CACHE_DIR"
  - "$PIPENV_CACHE_DIR"
env:
  global:
  - PIP_CACHE_DIR=$HOME/.cache/pip
  - PIPENV_CACHE_DIR=$HOME/.cache/pipenv
  - PIPENV_VENV_IN_PROJECT=yes
matrix:
  include:
  - name: Python 3.7.1 on Xenial Linux
    python: '3.7'
    dist: xenial
    env:
    - PYINST_DIST_NAME=beqdesigner
    - PIPENV_VERBOSITY=-1
    - COVERAGE_ARGS="--cov=./src/main/python"
    after_success:
    - bash <(curl -s https://codecov.io/bash)
  - name: Python 3.7.2 on macOS
    os: osx
    osx_image: xcode10.2
    language: shell
    env:
    - PYINST_DIST_NAME=BEQDesigner.app
  - name: Python 3.7.3 on Windows
    os: windows
    language: shell
    before_install: choco install python upx nsis
    env:
    - PATH=/c/Python37:/c/Python37/Scripts:$PATH
    - PYINST_DIST_NAME=beqdesigner.exe
addons:
  apt:
    packages:
    - libblas-dev
    - liblapack-dev
    - libsndfile1
    - upx
  homebrew:
    packages:
    - pipenv
    - upx
install:
- pip3 install --upgrade pip
- pip3 install pipenv
- pipenv install -d
script:
- PYTHONPATH=./src/main/python pipenv run pytest $COVERAGE_ARGS
before_deploy:
- pipenv run pip3 install pyinstaller
- pipenv run pyinstaller --clean --log-level=INFO -F beqdesigner.spec
deploy:
  provider: releases
  api_key:
    secure: "YOBRu5I4+9PyoD2LaRhg0kGzYqmA8NvcbKaJBJVtaHDf8ktbLlZdlxdT+oAvKIS9tFCjsA7DBkaFPGf5MRGbMMKn9/WV3mS83ImDZ/Z45bI1f2rQXsAoLeX5hEu0HaViyzB7HqDimN1dFkmCpkBW+kBEhsfLbMG4oPy66phJQdC74hB2sRwnB4tKVP7qmhlqmYZJk45aavPrV0fubNkHiF9gHDGsDjqPnc1K9IOghEsrdd6qFdJtNEjCYalcalqDbVfCK+4tqW6GJT8BTwW58YjevWdaqniq+mg8cdN0IJHLcBEct+EievqegsiQKhXzFCaaxe0tUN8ACSpMWCRSdxGJ6ka5k832CEjlD+mGVnOCX4AFx0aEi8DuRYmqC1vY9pVmnVHfXLFAOFUIPH81M4UEOMv4Sj0RylyYEYZHCAQhqJaYEndixTs/EeUCCwun3GPqmOaorIQbWH7H74aWxnZDlAqXPnLQFSF4i8f/0piGCkEw18TQtIPqnT3YflXvH35SrhkL/HifLPUyxk3bCT+GP9hCopX85Ry5772OHTXRlKYBAmtIvGZEZ+tPnFuLO+y42N2IlOm5Eci3zF40syw1jIbk3FzVRsBRBOfp1d2Uj2pPKUN0fATBQn8yfe5gBtbJByIUumFxHeXyUjdnDHOM57L/2m4TYZ8WfJP60DM="
  file: dist/$PYINST_DIST_NAME
  on:
    repo: 3ll3d00d/beqdesigner
    branch: travis
  skip_cleanup: true
  draft: true